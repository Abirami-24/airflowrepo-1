node{
   stage('SCM Checkout'){
     git 'https://github.com/Abirami-24/airflowrepo-1/'
     }
   stage('Deploy to airflow'){
    sshagent(['privkey']) {
    sh "echo ${currentBuild.number}"
    
    sh 'scp -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/pipeline/*.py  ec2-user@52.91.5.185:/home/ec2-user/airflow/dags/'
    sh 'pwd'
    sh 'whoami'
    sh "${currentBuild.number}"
    dir(ec2-user@52.91.5.185:/home/ec2-user/airflow/dags/)
    {
    
    sh 'whoami'
    sh 'pwd'
    sh 'airflow webserver -p 8080 & airflow scheduler  && fg'
    
    }
    
     }
    
    }
}  
