node{
   stage('SCM Checkout'){
     git 'https://github.com/Abirami-24/airflowrepo-1/'
     }
   stage('Deploy to airflow'){
    sshagent(['privkey']) {
    sh "echo ${currentBuild.number}"
    
    sh 'scp -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/pipeline/*.py  ec2-user@52.91.5.185:/home/ec2-user/airflow/dags/'
    sh 'pwd'
    sh 'whoami'
    sh "echo ${currentBuild.number}"
    sh 'ssh -tt -i "jenkins.pem" ec2-user@ec2-54-175-57-30.compute-1.amazonaws.com'
    sh 'cd /home/ec2-user/airflow'
    dir("/home/ec2-user/airflow/")
    {
    
    sh 'whoami'
    sh 'pwd'
    sh 'airflow webserver -p 8080 & airflow scheduler  && fg'
    
    }
    
     }
    
    }
}  
