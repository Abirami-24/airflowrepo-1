node{
   stage('SCM Checkout'){
     git 'https://github.com/Abirami-24/airflowrepo-1/'
     }
   stage('Deploy to airflow'){
    sshagent(['privkey']) {
    sh "echo ${currentBuild.number}"
    
    sh 'scp -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/pipeline/*.py  ec2-user@52.91.5.185:/home/ec2-user/airflow/dags/'
    
    sh 'pwd'
    sh 'whoami'
    dir("/home/ec2-user/pem/"){
    sh 'whoami'
    sh 'chmod 400 jen1.pem'
    
    sh 'ssh  -tt -i "jen1.pem" ec2-user@ec2-54-175-57-30.compute-1.amazonaws.com'
    sh 'ls'
    }
    sh 'rsync --rsh="sshpass -p 'jenkins.pem' ssh -o StrictHostKeyChecking=no -l ec2-user" ec2-user@52.91.5.185:/home/ec2-user/airflow/'
    sh 'ls'
    sh 'pwd'
    
     }
    
    }
}  
